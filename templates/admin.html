<!-- admin.html -->

<!DOCTYPE html>
<html>
<head>
    <title>Admin Page</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
    </style>
</head>
<body>
    <h1>Admin Page</h1>
    <h2>Users</h2>
    <table>
        <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Role</th>
            <th>Actions</th>
        </tr>
        {% for user in users %}
        <tr>
            <td>{{ user.id }}</td>
            <td>{{ user.username }}</td>
            <td>{{ user.role }}</td>
            <td>
                <a href="#" onclick="updateUser({{ user.id }})">Update</a>
                <a href="#" onclick="deleteUser({{ user.id }})">Delete</a>
            </td>
        </tr>
        {% endfor %}
    </table>

    <h2>Create New User</h2>
    <form id="create-user-form">
        <label for="username">Username:</label>
        <input type="text" id="username" name="username"><br><br>
        <label for="password">Password:</label>
        <input type="password" id="password" name="password"><br><br>
        <label for="role">Role:</label>
        <select id="role" name="role">
            <option value="user">User</option>
            <option value="admin">Admin</option>
        </select><br><br>
        <input type="submit" value="Create User">
    </form>

    <h2>Update User</h2>
    <form id="update-user-form" style="display: none;">
        <label for="username">Username:</label>
        <input type="text" id="update-username" name="username"><br><br>
        <label for="role">Role:</label>
        <select id="update-role" name="role">
            <option value="user">User</option>
            <option value="admin">Admin</option>
        </select><br><br>
        <input type="hidden" id="update-id" name="id">
        <input type="submit" value="Update User">
    </form>

    <script>
        function updateUser(userId) {
            document.getElementById("update-id").value = userId;
            document.getElementById("update-user-form").style.display = "block";
        }

        function deleteUser(userId) {
            if (confirm("Are you sure you want to delete user " + userId + "?")) {
                window.location.href = "/users/" + userId + "?_method=DELETE";
            }
        }

        document.getElementById("create-user-form").addEventListener("submit", function(event) {
            event.preventDefault();
            var formData = new FormData(this);
            fetch("/register", {
                method: "POST",
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                window.location.reload();
            })
            .catch(error => console.error(error));
        });

        document.getElementById("update-user-form").addEventListener("submit", function(event) {
            event.preventDefault();
            var formData = new FormData(this);
            fetch("/users/" + formData.get("id"), {
                method: "PUT",
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                window.location.reload();
            })
            .catch(error => console.error(error));
        });
    </script>
</body>
</html>
