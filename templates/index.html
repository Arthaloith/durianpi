<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="static/styles.css" type="text/css" />
    <title>Soil Moisture Status</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="../static/scripts.js"></script>
    <style>
        table {
            width: 60%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:nth-child(even){background-color: #f9f9f9;}
        button {
            background-color: #f44336; /* Red */
            color: white;
            padding: 6px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #d32f2f;
        }
    </style>
</head>
<body>
    <h1>Soil Moisture Status</h1>
    <p>Latest Pump Run: {{ latest_pump_run.timestamp }} (duration: {{ latest_pump_run.duration }})</p>
    <h2 style="text-align:center">System Information</h2>
    <div class="system-info">
        <div class="system-info-box">
            <p class="system-info-label">RAM Usage</p>
            <p class="system-info-value"><span id="ramUsage">{{ ram_usage }}</span>%</p>
        </div>
        
        <div class="system-info-box">
            <p class="system-info-label">CPU Usage</p>
            <p class="system-info-value"><span id="cpuUsage">{{ cpu_usage }}</span>%</p>
        </div>
        
        <div class="system-info-box">
            <p class="system-info-label">CPU Temp</p>
            <p class="system-info-value"><span id="cpuTemp">{% if cpu_temp != 'N/A' %}{{ cpu_temp.current }} 700700700{% else %}N/A{% endif %}</span></p>
        </div>
    
        <div class="system-info-box">
            <p class="system-info-label">Soil Moisture</p>
            <p class="system-info-value"><span id="soilMoisture">{{ soil_moisture | round }}</span></p>
        </div>
    </div>
    
    <!-- Display Active Profile Information -->
    <div class="active-profile-info">
        <h2 style="text-align:center">Active Profile</h2>
        <p>Name: <strong>{{ active_profile.name if active_profile else 'None selected' }}</strong></p>
        <p>Current Soil Moisture Threshold: <strong>{{ active_profile.soil_moisture_threshold if active_profile else 'N/A' }}</strong></p>
    </div>

    
    <div style="display: flex; justify-content: center; align-items: center;">
        <form action="/select_profile" method="post">
            <label for="profile_selection">Select Profile:</label>
            <select name="profile_id" id="profile_selection">
                {% for profile in profiles %}
                    <option value="{{ profile['id'] }}" {% if profile['is_active'] == 1 %} selected {% endif %}>
                        {{ profile['name'] }}
                    </option>
                {% endfor %}
            </select>
            <button type="submit">Set Active Profile</button>
        </form>
    </div>
    
    <h2 style="text-align:center">Manage Profiles</h2>
    <table style="margin-left: auto; margin-right: auto;">
        <thead>
            <tr>
                <th>Profile Name</th>
                <th>Soil Moisture Threshold</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for profile in profiles %}
            <tr>
                <td>{{ profile['name'] }}</td>
                <td>{{ profile['soil_moisture_threshold'] }}</td>
                <td>
                    <form action="{{ url_for('delete_profile', profile_id=profile['id']) }}" method="post">
                        <button type="submit" onclick="return confirm('Are you sure you want to delete this profile?');">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    
    
    <br>
    <div style="display: flex; justify-content: center; align-items: center;">
        <form action="/update_profile" method="post">
            <label for="profile_name">Profile Name:</label>
            <input type="text" id="profile_name" name="profile_name" required>
            <label for="soil_moisture_threshold">Soil Moisture Threshold:</label>
            <input type="number" id="soil_moisture_threshold" name="soil_moisture_threshold" required>
            <button type="submit">Save Profile</button>
        </form>
    </div>
    
    
    
    <h2 style="text-align:center">Pump History (only top 5 latest entries)</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Timestamp</th>
                <th>Event</th>
                <th>Duration</th>
            </tr>
        </thead>
        <tbody>
            {% for pump_run in pump_history %}
            <tr>
                <td>{{ pump_run.id }}</td>
                <td>{{ pump_run.timestamp }}</td>
                <td>{{ pump_run.event }}</td>
                <td>{{ pump_run.duration }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <div class="button-group">
        <form action="/force_water" method="post">
            <button type="submit">Force Watering</button>
        </form>
        <form action="/skip_water" method="post">
            <button type="submit">Skip Watering</button>
        </form>
        <form action="/poll" method="post">
            <button type="submit">Force Polling</button>
        </form>
        <form action="/history" method="post">
            <button type="submit">Show full history</button>
        </form>
        <form action="/clear" method="post">
            <button type="submit" class="clear-history-button">Clear history</button>
        </form>
    </div>
    
</body>
</html>